<!DOCTYPE html>
<html lang="zh-TW">
    <head>
        <title>出勤儀表板</title>

        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
            crossorigin="anonymous"
        />
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

        <style>
            body {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                background-attachment: fixed;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                margin: 0;
                padding: 0;
            }

            .card {
                background: rgba(255, 255, 255, 0.75);
                backdrop-filter: blur(10px);
                border: none;
                border-radius: 15px;
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
                transition: transform 0.3s ease, box-shadow 0.3s ease;
            }

            .card:hover {
                transform: translateY(-5px);
                box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
            }

            .chart-container {
                position: relative;
                height: 300px;
                width: 100%;
            }

            .card-title {
                font-size: 1.5rem;
                font-weight: bold;
                color: #2c3e50;
            }

            .card-text {
                font-size: 1rem;
                color: #7f8c8d;
            }

            .stat-value {
                font-size: 2rem;
                font-weight: bold;
                color: #2c3e50;
            }
        </style>
    </head>

    <body>
        <div class="container-fluid py-4">
            <!-- Header Section -->
            <div class="card bg-white bg-opacity-75 shadow-lg rounded-4 mb-4 mx-3 border-0">
                <div class="card-body text-center py-4">
                    <h1 id="student_name" class="display-5 fw-bold text-dark mb-2"></h1>
                    <p class="text-muted fs-5 mb-0">個人出勤儀表板</p>
                </div>
            </div>

            <!-- Statistics Cards -->
            <div class="row g-3 mx-3 mb-4">
                <div class="col-12 col-sm-6 col-lg-2">
                    <div class="card h-100">
                        <div class="card-body d-flex flex-column justify-content-center">
                            <i class="fas fa-clock fs-1 text-primary mb-2"></i>
                            <p class="card-text">總課程時數</p>
                            <h5 class="stat-value" id="class_hours"></h5>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-sm-6 col-lg-2">
                    <div class="card h-100">
                        <div class="card-body d-flex flex-column justify-content-center">
                            <i class="fas fa-check-circle fs-1 text-success mb-2"></i>
                            <p class="card-text">實際上課時數</p>
                            <h5 class="stat-value" id="attended_hours"></h5>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-sm-6 col-lg-2">
                    <div class="card h-100">
                        <div class="card-body d-flex flex-column justify-content-center">
                            <i class="fas fa-times-circle fs-1 text-danger mb-2"></i>
                            <p class="card-text">缺席時數</p>
                            <h5 class="stat-value" id="absent_hours"></h5>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-sm-6 col-lg-2">
                    <div class="card h-100">
                        <div class="card-body d-flex flex-column justify-content-center">
                            <i class="fas fa-exclamation-triangle fs-1 text-warning mb-2"></i>
                            <p class="card-text">遲到時數</p>
                            <h5 class="stat-value" id="late_hours"></h5>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-sm-6 col-lg-2">
                    <div class="card h-100">
                        <div class="card-body d-flex flex-column justify-content-center">
                            <i class="fas fa-arrow-left fs-1 text-secondary mb-2"></i>
                            <p class="card-text">早退時數</p>
                            <h5 class="stat-value" id="leave_early_hours"></h5>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-sm-6 col-lg-2">
                    <div class="card h-100">
                        <div class="card-body d-flex flex-column justify-content-center">
                            <i class="fas fa-percentage fs-1 text-info mb-2"></i>
                            <p class="card-text">出勤比率</p>
                            <h5 class="stat-value" id="attendance_rate"></h5>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="row g-4 mx-3">
                <div class="col-12 col-lg-4">
                    <div class="card h-100">
                        <div class="card-header bg-transparent border-0 text-center pt-4">
                            <h5 class="card-title">
                                <i class="fas fa-chart-line text-primary me-2"></i>
                                每日上課時數
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="attendance_hours"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-lg-4">
                    <div class="card h-100">
                        <div class="card-header bg-transparent border-0 text-center pt-4">
                            <h5 class="card-title">
                                <i class="fas fa-chart-bar text-success me-2"></i>
                                每日在校時數
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="raw_hours"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-lg-4">
                    <div class="card h-100">
                        <div class="card-header bg-transparent border-0 text-center pt-4">
                            <h5 class="card-title">
                                <i class="fas fa-chart-pie text-danger me-2"></i>
                                出席狀況
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="attendance"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            fetch("attendance_log.json")
                .then((res) => res.json())
                .then((data) => {
                    document.getElementById(
                        "student_name"
                    ).innerHTML = `${data["data"][0]["name"]}`;
                    document.getElementById(
                        "class_hours"
                    ).innerHTML = `${data["data"][0]["class_hours"]} hr`;
                    document.getElementById(
                        "attended_hours"
                    ).innerHTML = `${data["data"][0]["attended_hours"]} hr`;
                    document.getElementById(
                        "absent_hours"
                    ).innerHTML = `${data["data"][0]["absent_hours"]} hr`;
                    document.getElementById(
                        "late_hours"
                    ).innerHTML = `${data["data"][0]["late_hours"]} hr`;
                    document.getElementById(
                        "leave_early_hours"
                    ).innerHTML = `${data["data"][0]["leave_early_hours"]} hr`;
                    document.getElementById(
                        "attendance_rate"
                    ).innerHTML = `${Math.round(data["data"][0]["attendance_rate"]*100)}%`;

                    const ctx3 = document.getElementById("attendance");
                    new Chart(ctx3, {
                        type: "pie",
                        data: {
                            labels: ["出席", "缺席"],
                            datasets: [
                                {
                                    label: "出席狀況",
                                    data: [
                                        data["data"][0]["attendance_rate"],
                                        1 - data["data"][0]["attendance_rate"],
                                    ],
                                    backgroundColor: [
                                        "rgba(46, 204, 113, 0.8)",
                                        "rgba(231, 76, 60, 0.8)",
                                    ],
                                    borderColor: [
                                        "rgba(46, 204, 113, 1)",
                                        "rgba(231, 76, 60, 1)",
                                    ],
                                    borderWidth: 2,
                                },
                            ],
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom',
                                    labels: {
                                        padding: 20,
                                        font: {
                                            size: 14
                                        }
                                    }
                                }
                            }
                        }
                    });
                });
        </script>

        <script>
            fetch("attendance_2.json")
                .then((res) => res.json())
                .then((data) => {
                    let date = [];
                    let attended_hours = [];
                    let raw_hours = [];

                    for (let i = 0; i < data["data"].length; i++) {
                        date.push(data["data"][i]["class_date"]);
                        attended_hours.push(data["data"][i]["attended_hours"]);
                        raw_hours.push(data["data"][i]["raw_hours"]);
                    }

                    const ctx1 = document.getElementById("attendance_hours");
                    const ctx2 = document.getElementById("raw_hours");

                    new Chart(ctx1, {
                        type: "line",
                        data: {
                            labels: date,
                            datasets: [
                                {
                                    label: "每日上課時數",
                                    data: attended_hours,
                                    backgroundColor: "rgba(52, 152, 219, 0.1)",
                                    borderColor: "rgba(52, 152, 219, 1)",
                                    borderWidth: 3,
                                    fill: true,
                                    tension: 0.4,
                                    pointBackgroundColor: "rgba(52, 152, 219, 1)",
                                    pointBorderColor: "#fff",
                                    pointBorderWidth: 2,
                                    pointRadius: 6,
                                },
                            ],
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    grid: {
                                        color: "rgba(0,0,0,0.1)"
                                    }
                                },
                                x: {
                                    grid: {
                                        color: "rgba(0,0,0,0.1)"
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    display: false
                                }
                            }
                        },
                    });

                    new Chart(ctx2, {
                        type: "bar",
                        data: {
                            labels: date,
                            datasets: [
                                {
                                    label: "每日在校時數",
                                    data: raw_hours,
                                    backgroundColor: "rgba(46, 204, 113, 0.8)",
                                    borderColor: "rgba(46, 204, 113, 1)",
                                    borderWidth: 1,
                                    borderRadius: 8,
                                },
                            ],
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    grid: {
                                        color: "rgba(0,0,0,0.1)"
                                    }
                                },
                                x: {
                                    grid: {
                                        color: "rgba(0,0,0,0.1)"
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    display: false
                                }
                            }
                        },
                    });
                });
        </script>

        <script
            src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
            integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
            crossorigin="anonymous"></script>

        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
            integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
            crossorigin="anonymous"></script>
    </body>
</html>
